{
    "openapi": "3.0.2",
    "info": {
        "title": "Salesforce Henvendelse API",
        "version": "1.0"
    },
    "servers": [{ "url": "https://test.salesforce.com/services/apexrest" }],
    "paths": {
        "/henvendelse/journal": {
            "post": {
                "tags": ["Journal"],
                "description": "Endepunkt for igangsettelse av journalføring mot JOARK.",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/X-Correlation-ID"
                    },
                    {
                        "name": "JournalRequest",
                        "in": "body",
                        "required": true,
                        "description": "JSON request med metadata for journalpost",
                        "schema": {
                            "$ref": "#/components/schemas/JournalRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "400": {
                        "$ref": "#/components/responses/BadRequest"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        },
        "/henvendelse/behandling/{henvId}": {
            "patch": {
                "tags": ["Henvendelse Behandling"],
                "description": "Behandling/oppdatering av eksisterende henvendelser. Benyttes til f.eks å oppdatere felter som kasseringsdato, gjeldendeTema. Request body er JSON som følger objektmodellen til henvendelse, men krever kun at du sender med felter hvor dataene skal oppdateres.",
                "parameters": [
                    {
                        "name": "henvId",
                        "in": "path",
                        "required": true,
                        "description": "Unik id til samtalereferat eller tråd som man ønsker å behandle"
                    },
                    {
                        "$ref": "#/components/parameters/X-Correlation-ID"
                    },
                    {
                        "name": "HenvendelseData",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#components/schemas/Henvendelse"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "400": {
                        "$ref": "#/components/responses/BadRequest"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFound"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        },
        "/henvendelse/ny/samtalereferat": {
            "post": {
                "tags": ["Ny Henvendelse"],
                "description": "Opprett nytt samtalereferat tilknyttet en aktør",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/X-Correlation-ID"
                    },
                    {
                        "name": "SamtalereferatRequest",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#components/schemas/SamtalereferatRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "400": {
                        "$ref": "#/components/responses/BadRequest"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFound"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        },
        "/henvendelse/ny/melding": {
            "post": {
                "tags": ["Ny Henvendelse"],
                "description": "Opprett ny melding relatert til en aktør",
                "parameters": [
                    {
                        "$ref": "#/components/parameters/X-Correlation-ID"
                    },
                    {
                        "name": "kjedeId",
                        "in": "query",
                        "required": false,
                        "description": "Kjedeid hvis ny melding skal opprettes på en eksisterende tråd. Hvis denne er blank opprettes meldingen på en ny tråd."
                    },
                    {
                        "name": "SamtalereferatRequest",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#components/schemas/MeldingRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "400": {
                        "$ref": "#/components/responses/BadRequest"
                    },
                    "403": {
                        "description": "Cannot insert new message on closed thread",
                        "$ref": "#/components/responses/NoNewMessageOnClosedThread"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFound"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        },
        "/henvendelseinfo/henvendelseliste": {
            "get": {
                "tags": ["Henvendelse Info"],
                "description": "",
                "parameters": [
                    {
                        "name": "aktorid",
                        "in": "query",
                        "required": true,
                        "description": "Aktørid til person for uthentelse av henvendelseliste"
                    },
                    {
                        "$ref": "#/components/parameters/X-Correlation-ID"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#components/schemas/Henvendelse"
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "$ref": "#/components/responses/BadRequest"
                    },
                    "404": {
                        "$ref": "#/components/responses/NotFound"
                    },
                    "500": {
                        "$ref": "#/components/responses/InternalServerError"
                    }
                }
            }
        }
    },
    "security": [{ "Salesforce_auth": [] }],
    "components": {
        "schemas": {
            "MeldingRequest": {
                "type": "object",
                "properties": {
                    "aktorId": {
                        "type": "string",
                        "example": "2786793959304"
                    },
                    "temagruppe": {
                        "type": "string",
                        "example": "ARBD"
                    },
                    "enhet": {
                        "type": "string",
                        "example": "4100"
                    },
                    "fritekst": {
                        "type": "string",
                        "example": "Dette er en melding"
                    }
                }
            },
            "SamtalereferatRequest": {
                "type": "object",
                "properties": {
                    "aktorId": {
                        "type": "string",
                        "example": "2786793959304"
                    },
                    "temagruppe": {
                        "type": "string",
                        "example": "ARBD"
                    },
                    "enhet": {
                        "type": "string",
                        "example": "4100"
                    },
                    "fritekst": {
                        "type": "string",
                        "example": "Dette er en melding"
                    },
                    "kanal": {
                        "type": "string",
                        "enum": ["TELEFON", "OPPMOTE"],
                        "description": "Definerer om referatet er skrevet etter en telefonsamtale eller et fysisk oppmote hos NAV",
                        "example": "TELEFON"
                    }
                }
            },
            "JournalRequest": {
                "type": "object",
                "properties": {
                    "journalforendeEnhet": {
                        "type": "string",
                        "description": "NAV-enhet til veilder/saksbehandler som opprettet journalposten",
                        "example": "4100"
                    },
                    "journalforerNavIdent": {
                        "type": "string",
                        "description": "NAV-Ident til veilder/saksbehandler som opprettet journalposten",
                        "example": "Z999999"
                    },
                    "saksId": {
                        "type": "string",
                        "description": "Referanse til fagsak i overenstemmelse med påkrevd input til [Dokarkiv API](https://dokarkiv-q2.nais.preprod.local/swagger-ui.html#/arkiver-og-journalfoer-rest-controller/opprettJournalpostUsingPOST). Ved blank/null som saksId vil journalposten opprettes som generell sak på tema.",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "temakode": {
                        "type": "string",
                        "description": "Temakode for journalpost som skal opprettes",
                        "example": "DAG"
                    },
                    "henvendelseId": {
                        "type": "string",
                        "description": "Unik ID til henvendelsen som skal journalføres",
                        "example": "a0J3N000004dUBJUA2"
                    }
                }
            },
            "Journalpost": {
                "type": "object",
                "properties": {
                    "journalforerNavIdent": {
                        "type": "string",
                        "description": "NAV-ident til veilder/saksbehandler som opprettet journalposten",
                        "example": "Z999999"
                    },
                    "journalfortDato": {
                        "type": "string",
                        "description": "Dato for opprettelse av journalpost",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "journalfortTema": {
                        "type": "string",
                        "description": "Tema for opprettet journalpost",
                        "example": "DAG"
                    },
                    "journalpostId": {
                        "type": "string",
                        "description": "Unik referanse til journalpost i JOARK",
                        "example": "509934220"
                    }
                }
            },
            "MeldingFra": {
                "type": "object",
                "properties": {
                    "identType": {
                        "type": "string",
                        "enum": ["NAVIDENT", "AKTORID"],
                        "description": "Type ident for relatert avsender",
                        "example": "NAVIDENT"
                    },
                    "ident": {
                        "type": "string",
                        "description": "Avsenders ident (AKTORID/NAVIDENT)",
                        "example": "Z999999"
                    }
                }
            },
            "Melding": {
                "type": "object",
                "properties": {
                    "fritekst": {
                        "type": "string",
                        "description": "Meldingen som ble skrevet"
                    },
                    "sendtDato": {
                        "type": "string",
                        "description": "Datetime string",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "lestDato": {
                        "type": "string",
                        "description": "Datetime string",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "fra": {
                        "$ref": "#components/schemas/MeldingFra"
                    }
                }
            },
            "Henvendelse": {
                "type": "object",
                "properties": {
                    "henvendelseType": {
                        "type": "string",
                        "enum": ["SAMTALEREFERAT", "MELDING", "MELDINGSKJEDE"]
                    },
                    "fnr": {
                        "type": "string",
                        "example": "12345678910"
                    },
                    "aktorId": {
                        "type": "string",
                        "example": "2786793959304"
                    },
                    "opprinneligGT": {
                        "type": "string",
                        "example": "2786793959304"
                    },
                    "opprettetDato": {
                        "type": "string",
                        "description": "Datetime string",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "avsluttetDato": {
                        "type": "string",
                        "description": "Datetime string",
                        "example": "2021-06-28T12:00:00.000Z"
                    },
                    "kasseringsDato": {
                        "type": "string",
                        "description": "Datetime string",
                        "example": "2021-06-27T12:00:00.000Z"
                    },
                    "henvendelseId": {
                        "type": "string"
                    },
                    "kjedeId": {
                        "type": "string"
                    },
                    "gjeldendeTemagruppe": {
                        "type": "string",
                        "example": "ARBD"
                    },
                    "gjeldendeTema": {
                        "type": "string",
                        "example": "DAG"
                    },
                    "journalposter": {
                        "type": "array",
                        "items": {
                            "$ref": "#components/schemas/Journalpost"
                        }
                    },
                    "meldinger": {
                        "type": "array",
                        "items": {
                            "$ref": "#components/schemas/Melding"
                        }
                    }
                }
            },
            "Error": {
                "type": "object",
                "properties": {
                    "statusCode": {
                        "type": "integer"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            }
        },
        "responses": {
            "NotFound": {
                "description": "NOT FOUND",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "Forbidden": {
                "description": "FORBIDDEN",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "NoNewMessageOnClosedThread": {
                "description": "Cannot insert new message on closed thread",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "statusCode": {
                                    "type": "integer",
                                    "example": 403
                                },
                                "message": {
                                    "type": "string",
                                    "example": "Cannot insert new message on closed thread"
                                }
                            }
                        }
                    }
                }
            },
            "BadRequest": {
                "description": "BAD REQUEST",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            },
            "InternalServerError": {
                "description": "UNEXPECTED EXCEPTION",
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Error"
                        }
                    }
                }
            }
        },
        "parameters": {
            "X-Correlation-ID": {
                "name": "X-Correlation-ID",
                "in": "header",
                "required": true,
                "description": "Unik UUID for inkommende request"
            }
        },
        "securitySchemes": {
            "Salesforce_auth": {
                "type": "http",
                "scheme": "bearer"
            }
        }
    }
}
