<template>
    <div class="navds-stack navds-vstack navds-stack-gap navds-stack-direction">
        <template for:each={decoratedGroups} for:item="group">
            <div key={group.groupKey}>
                <!-- Render each Event message individually -->
                <template for:each={group.messages} for:item="msg">
                    <template lwc:if={msg.isEvent}>
                        <c-crm-messaging-message-event
                            key={msg.message.Id}
                            message={msg.message}
                            external={msg.isExternal}
                            preferred-name="Du"
                        >
                        </c-crm-messaging-message-event>
                    </template>
                </template>

                <!-- Render grouped non-Event messages if any -->
                <template lwc:if={group.nonEventMessages.length}>
                    <c-community-external-message-group
                        lwc:if={group.isExternal}
                        messages={group.nonEventMessages}
                        class="external-message-group"
                    ></c-community-external-message-group>
                    <c-community-internal-message-group
                        lwc:else
                        messages={group.nonEventMessages}
                    ></c-community-internal-message-group>
                </template>
            </div>
        </template>
    </div>
</template>
