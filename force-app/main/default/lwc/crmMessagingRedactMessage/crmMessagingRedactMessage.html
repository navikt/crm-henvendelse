<template>
    <template if:false={isEvent}>
        <li if:true={isRedacting} class={liClasses}>
            <div class="slds-chat-message">
                <div class="slds-chat-message__body">
                    <div class={divClasses}>
                        <!-- <lightning-formatted-rich-text
                            if:false={isRedacting}
                            value={message.CRM_Message_Text__c}
                        ></lightning-formatted-rich-text> -->
                        <lightning-record-edit-form
                            if:true={isRedacting}
                            object-api-name="Message__c"
                            record-id={messageId}
                            onsuccess={handleSuccess}
                            onerror={handleError}
                            style="display: flex"
                            class="slds-text-color_default"
                        >
                            <c-crm-redact-text
                                text-to-redact={messageText}
                                ontext_redacted={handleRedactEvent}
                                class="width_large"
                            >
                                <lightning-button-group slot="toolbar">
                                    <lightning-button-icon
                                        icon-name="utility:undo"
                                        disabled={canUndoDisabled}
                                        alternative-text="Angre"
                                        onclick={undoRedacting}
                                    ></lightning-button-icon>
                                    <lightning-button-icon
                                        icon-name="utility:redo"
                                        disabled={canRedoDisabled}
                                        alternative-text="Gjør om"
                                        onclick={redoRedacting}
                                    ></lightning-button-icon>
                                </lightning-button-group>
                                <lightning-button
                                    slot="toolbar"
                                    label="Lagre"
                                    icon-name="utility:save"
                                    disabled={canUndoDisabled}
                                    onclick={saveMessage}
                                    variant="brand"
                                    type="submit"
                                    class="slds-p-left_large"
                                ></lightning-button>
                            </c-crm-redact-text>
                            <lightning-input-field
                                class="slds-hide"
                                value={redactedText}
                                field-name="CRM_Message_Text__c"
                            ></lightning-input-field>
                            <lightning-input-field
                                class="slds-hide"
                                value={falseValue}
                                field-name="CRM_Is_Redacted__c"
                            ></lightning-input-field>
                        </lightning-record-edit-form>
                    </div>
                    <div class="slds-chat-message__meta">
                        {message.CRM_From_First_Name__c} &nbsp;
                        <lightning-formatted-date-time
                            value={message.CreatedDate}
                            month="numeric"
                            day="numeric"
                            year="numeric"
                            hour="2-digit"
                            minute="2-digit"
                        >
                        </lightning-formatted-date-time>
                        <lightning-button-stateful
                            class="slds-chat-message__action slds-float_right"
                            icon-name-when-off="utility:edit"
                            icon-name-when-on="utility:edit"
                            selected={isRedacting}
                            onclick={toggleRedacting}
                            label-when-off="Start sladding"
                            label-when-on="Avbryt sladding"
                        ></lightning-button-stateful>
                    </div>
                </div>
            </div>
        </li>
        <li class={liClasses} if:false={isRedacting}>
            <div class="slds-chat-message">
                <div class="slds-chat-message__body">
                    <div class={divClasses}>
                        <lightning-formatted-rich-text
                            value={message.CRM_Message_Text__c}
                        ></lightning-formatted-rich-text>
                    </div>

                    <div class="slds-chat-message__meta">
                        {message.CRM_From_First_Name__c} &nbsp;
                        <lightning-formatted-date-time
                            value={message.CreatedDate}
                            month="numeric"
                            day="numeric"
                            year="numeric"
                            hour="2-digit"
                            minute="2-digit"
                        >
                        </lightning-formatted-date-time>
                        <lightning-button-stateful
                            class="slds-chat-message__action slds-float_right"
                            icon-name-when-off="utility:edit"
                            icon-name-when-on="utility:edit"
                            selected={isRedacting}
                            onclick={toggleRedacting}
                            label-when-off="Start sladding"
                            label-when-on="Avbryt sladding"
                        ></lightning-button-stateful>
                    </div>
                </div>
            </div>
        </li>
    </template>
    <template if:true={isEvent}>
        <li class="slds-chat-listitem slds-chat-listitem_event">
            <div class="slds-chat-event">
                <div class="slds-chat-event__body">
                    <p>
                        {message.CRM_Message_Text__c} •
                        <lightning-formatted-date-time
                            value={message.CreatedDate}
                            month="numeric"
                            day="numeric"
                            year="numeric"
                            hour="2-digit"
                            minute="2-digit"
                        >
                        </lightning-formatted-date-time>
                    </p>
                </div>
            </div>
        </li>
    </template>
</template>
